<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>stereoVision: SFM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">stereoVision
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Groups</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SFM</div>  </div>
</div><!--header-->
<div class="contents">

<p>Structure From Motion (SFM) module for estimation of estrinsics parameter and computation of depth map.  
<a href="#details">More...</a></p>
<p>Structure From Motion (SFM) module for estimation of estrinsics parameter and computation of depth map. </p>
<p>Copyright (C) 2013 RobotCub Consortium</p>
<p>Author: Sean Ryan Fanello</p>
<p>Date: first release around 24/07/2013</p>
<p>CopyPolicy: Released under the terms of the GNU GPL v2.0.</p>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>The module uses a complete Structure From Motion (SFM) pipeline for the computation of the extrinsics parameters between two different views. These parameters are then used to rectify the images and to compute a depth map using the H. Hirschmuller Algorithm (CVPR 2006) implemented since Opencv 2.2. The Kinematics of the iCub is used to guess the current camera positions, then visual features are used to refine this model. Before starting, make sure you have calibrated the intrinsics parameters. For the stereo calibration see the module <a href="http://wiki.icub.org/iCub/main/dox/html/group__icub__stereoCalib.html">stereoCalib</a>. The module provides three output ports: the first one is the disparity map in grayscale values, the second port is the WorldImage, that is a 3-channels float image, where in each pixel are stored the three X Y Z coordinates with respect to robot root reference frame. The third port outputs the current keypoints match. Non valid points are handled with the special value (0,0,0). In addition, a rpc port supports requests for 3D/2D points computation (see below).</p>
<h1><a class="anchor" id="lib_sec"></a>
Libraries</h1>
<p>YARP libraries and OpenCV 2.2 (at least). <br />
For better performance, we suggest you to run the module on a machine equipped with GPU functionality along with the <a href="http://cs.unc.edu/~ccwu/siftgpu">SiftGPU</a> library installed.</p>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<p>&ndash;name <em>SFM</em> </p><ul>
<li>The parameter <em>stemName</em> specifies the stem name of ports created by the module.</li>
</ul>
<p>&ndash;robot <em>robotName</em> </p><ul>
<li>The parameter <em>robotName</em> specifies the name of the robot.</li>
</ul>
<p>&ndash;leftPort <em>/left</em>:i</p><ul>
<li>The parameter <em>inputLeft</em> specifies the left image input port.</li>
</ul>
<p>&ndash;rightPort <em>/right</em>:i</p><ul>
<li>The parameter <em>inputRight</em> specifies the right image input port.</li>
</ul>
<p>&ndash;outDispPort <em>/disp</em>:o</p><ul>
<li>The parameter <em>/disparity</em>:o specifies the output port for the disparity image.</li>
</ul>
<p>&ndash;outMatchPort <em>/match</em>:o</p><ul>
<li>The parameter <em>/match</em>:o specifies the output port for the match image.</li>
</ul>
<p>&ndash;outWorldPort <em>/world</em>:o</p><ul>
<li>The parameter <em>/world</em>:o specifies the output port for the world image.</li>
</ul>
<p>&ndash;CommandPort <em>comm</em> </p><ul>
<li>The parameter <em>comm</em> specifies the command port for rpc protocol.</li>
</ul>
<h1><a class="anchor" id="portsc_sec"></a>
Ports Created</h1>
<ul>
<li><em> /SFM/left:i </em> accepts the incoming images from the left eye.</li>
<li><em> /SFM/right:i </em> accepts the incoming images from the right eye.</li>
<li><em> /SFM/disp:o </em> outputs the disparity map in grayscale values.</li>
<li><em> /SFM/world:o</em> outputs the world image (3-channel float with X Y Z values).</li>
<li><em> /SFM/match:o</em> outputs the match image.</li>
<li><em> /SFM/rpc </em> for terminal commands comunication.<ul>
<li>[calibrate]: It recomputes the camera positions once.</li>
<li>[save]: It saves the current camera positions and uses it when the module starts.</li>
<li>[setNumDisp NumOfDisparities]: It sets the expected number of disparity (in pixel). Values must be divisible by 32. Good values are 64 for 320x240 images and 128 for 640x480 images.</li>
<li>[Point x y]: Given the pixel coordinate x,y in the Left image the response is the 3D Point: X Y Z computed using the depth map wrt the LEFT eye. Points with non valid disparity (i.e. occlusions) are handled with the value (0.0,0.0,0.0).</li>
<li>[x y]: Given the pixel coordinate x,y in the Left image the response is the 3D Point: X Y Z d computed using the depth map wrt the the ROOT reference system, d is the disparity (in pixel) between the left pixel x and the right pixel x+d. Points with non valid disparity (i.e. occlusions) are handled with the value (0.0,0.0,0.0).</li>
<li>[Left x y]: Given the pixel coordinate x,y in the Left image the response is the 3D Point: X Y Z computed using the depth map wrt the LEFT eye. Points with non valid disparity (i.e. occlusions) are handled with the value (0.0,0.0,0.0).</li>
<li>[Right x y]: Given the pixel coordinate x,y in the Left image the response is the 3D Point: X Y Z computed using the depth map wrt the RIGHT eye. Points with non valid disparity (i.e. occlusions) are handled with the value (0.0,0.0,0.0).</li>
<li>[Root x y]: Given the pixel coordinate x,y in the Left image the response is the 3D Point: X Y Z computed using the depth map wrt the ROOT reference system. Points with non valid disparity (i.e. occlusions) are handled with the value (0.0,0.0,0.0).</li>
<li>[uL_1 vL_1 uR_1 vR_1 ... uL_n vL_n uR_n vR_n]: Given n quadruples uL_i vL_i uR_i vR_i, where uL_i vL_i are the pixel coordinates in the Left image and uR_i vR_i are the coordinates of the matched pixel in the Right image, the response is a set of 3D points (X1 Y1 Z1 ... Xn Yn Zn) wrt the ROOT reference system.</li>
<li>[cart2stereo X Y Z]: Given a world point X Y Z wrt to ROOT reference frame the response is the projection (uL vL uR vR) in the Left and Right images.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="in_files_sec"></a>
Input Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="out_data_sec"></a>
Output Data Files</h1>
<p>None.</p>
<h1><a class="anchor" id="tested_os_sec"></a>
Tested OS</h1>
<p>Linux (Ubuntu 9.04, Debian Squeeze) and Windows 7. Tested against OpenCV versions: 2.2, 2.3, 2.4.</p>
<dl class="section author"><dt>Author</dt><dd>Sean Ryan Fanello </dd></dl>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 17 2014 11:36:07 for stereoVision by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
